{% extends 'site_base.html' %}
{% load static %}
{% load thumbnail %}

{% block title %}
  Explore books - Barham Books
{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/pages/explore-books.css' %}" />
  <link rel="stylesheet" href="{% static 'css/components/search-bar.css' %}" />
  <link rel="stylesheet" href="{% static 'css/components/carousel.css' %}" />
{% endblock %}

{% block extra_js %}
  <script src="{% static 'js/carousel.js' %}" defer></script>
{% endblock %}

{% block content %}
  <div class="search-label">
    <div class="wrapper search-label__wrapper">
      <label for="search-input" class="wrapper search-label__label">Search our library for books</label>
    </div>
  </div>

  {% include 'components/search_bar.html' %}

  <div class="explore">
    <div class="wrapper recently-added-wrapper">
      {% include 'components/carousel.html' with books=new_books title='Recently Added' tag='section' %}
    </div>
    {% comment %} {% include 'components/carousel.html' with books=featured_books title='Featured Books' tag='section' %}

    {% include 'components/carousel.html' with books=short_reads title='Short Reads' tag='section' %}

    <ul>
      {% for featured_author in popular_authors %}
        <li>{{ featured_author }} - {{ featured_author.num_books }}</li>
      {% endfor %}
    </ul>

    <br />

    <ul>
      {% for series in popular_series %}
        <li>{{ series.name }} - {{ series.num_books }}</li>
      {% endfor %}
    </ul>

    <br />

    <ul>
      {% for slug, collection in featured_collections.items %}
        <li>{{ collection.title }}</li>
      {% endfor %}
    </ul>

    <br /> {% endcomment %}

    <div class="recommended">
      <div class="recommended__bg">
        <div class="wrapper recommended__wrapper">
          <article class="recommended__article">
            <h1 class="recommended__title">Barham Recommends</h1>

            <p class="recommended__lede recommended__lede-one">
              <strong>The Girl on the Train</strong> by Paula Hawkins follows a troubled commuter who becomes fixated on a couple she observes from the train each morning. When she witnesses something disturbing, she is drawn into a missing person investigation that forces her to confront unreliable memories, buried trauma, and the dangerous consequences of obsession.
            </p>

            <figure class="recommended__book-figure recommended__figure-one">
              <a href="{{ rec_one.get_absolute_url }}" class="recommended__overlay-link"><span class="visually-hidden">{{ rec_one.title }}</span></a>
              <img class="recommended__book-image" src="{{ rec_one.photo.url }}" alt="Book cover for {{ rec_one.title }} by {{ rec_one.author }}" />
              <figcaption class="recommended__book-text">
                <h3 class="recommended__book-title">{{ rec_one.title }}</h3>
                <span class="recommended__book-author"><a href="{{ rec_one.author.get_absolute_url }}" class="recommended__author-link">{{ rec_one.author }}</a></span>
              </figcaption>
            </figure>

            <p class="recommended__lede recommended__lede-two">
              <strong>Never Let Me Go</strong> by Kazuo Ishiguro centres on Kathy and her friends, who grow up at an isolated English boarding school. As they move into adulthood, they begin to uncover the unsettling truth about their lives - and the quiet, devastating purpose that awaits them in a hauntingly restrained dystopian world.
            </p>

            <figure class="recommended__book-figure recommended__figure-two">
              <a href="{{ rec_two.get_absolute_url }}" class="recommended__overlay-link"><span class="visually-hidden">{{ rec_two.title }}</span></a>
              <img class="recommended__book-image" src="{{ rec_two.photo.url }}" alt="Book cover for {{ rec_two.title }} by {{ rec_two.author }}" />
              <figcaption class="recommended__book-text">
                <h3 class="recommended__book-title">{{ rec_two.title }}</h3>
                <span class="recommended__book-author"><a href="{{ rec_two.author.get_absolute_url }}" class="recommended__author-link">{{ rec_two.author }}</a></span>
              </figcaption>
            </figure>
          </article>

          {% include 'components/carousel.html' with books=featured_books title='Other Recommendations' tag='section' %}
        </div>
      </div>
    </div>

    <div class="wrapper popular-wrapper">
      <div class="popular">
        <section class="authors">
          <h2 class="popular__title">Popular Authors</h2>

          <ul class="popular__list">
            {% for pop_author in popular_authors %}
              <li class="popular__item" aria-label="{{ pop_author }}">
                <a href="{{ pop_author.get_absolute_url }}" class="popular__overlay-link"><span class="visually-hidden">{{ pop_author }}</span></a>

                <div class="popular__item-content">
                  <span class="popular__avatar">
                    {% if pop_author.photo %}
                      <img src="{{ pop_author.photo.url }}" alt="" />
                    {% endif %}
                  </span>

                  <div class="popular__item-text">
                    <h3 class="popular__name">{{ pop_author }}</h3>

                    <span class="popular__meta">{{ pop_author.num_books }} book{{ pop_author.num_books|pluralize }}</span>
                  </div>

                  {% if pop_author.books.all|length > 0 %}
                    <div class="popular__book-thumbs">
                      {% for author_book in pop_author.books.all|slice:':3' %}
                        {% if author_book.photo %}
                          <img src="{{ author_book.photo|thumbnail_url:'default' }}" alt="" class="popular__book-thumb" />
                        {% endif %}
                      {% endfor %}
                    </div>
                  {% endif %}
                </div>
              </li>
            {% endfor %}
          </ul>
        </section>

        <section class="series">
          <h2 class="popular__title">Popular Series</h2>

          <ul class="popular__list">
            {% for pop_series in popular_series %}
              <li class="popular__item" aria-label="{{ pop_series }}">
                <a href="{% url 'series_detail' pop_series.id %}" class="popular__overlay-link"><span class="visually-hidden">{{ pop_series }}</span></a>

                <div class="popular__item-content">
                  {% comment %} <span class="popular__avatar">
                    {% if pop_author.photo %}
                      <img src="{{ pop_author.photo.url }}" alt="" />
                    {% endif %}
                  </span> {% endcomment %}

                  <div class="popular__item-text">
                    <h3 class="popular__name">{{ pop_series }}</h3>

                    <span class="popular__meta">{{ pop_series.num_books }} book{{ pop_series.num_books|pluralize }}</span>
                  </div>

                  {% if pop_series.books.all|length > 0 %}
                    <div class="popular__book-thumbs">
                      {% for series_book in pop_series.books.all|slice:':3' %}
                        {% if series_book.photo %}
                          <img src="{{ series_book.photo|thumbnail_url:'default' }}" alt="" class="popular__book-thumb" />
                        {% endif %}
                      {% endfor %}
                    </div>
                  {% endif %}
                </div>
              </li>
            {% endfor %}
          </ul>
        </section>
      </div>
    </div>

    <div class="wrapper">
      <section class="explore-cta">
        <article class="explore-cta__card">
          <a href="{% url 'collections' %}" class="explore-cta__overlay-link"><span class="visually-hidden">Browse collections</span></a>

          <div class="explore-cta__content">
            <h3 class="explore-cta__title">Browse Collections</h3>

            <p class="explore-cta__text">Discover curated reading lists across genres, themes and moods.</p>

            {% comment %} <span class="explore-cta__cta">View collections -></span> {% endcomment %}
          </div>
        </article>

        <article class="explore-cta__card">
          <a href="{% url 'books_a_z' %}" class="explore-cta__overlay-link"><span class="visually-hidden">Browse A-Z</span></a>

          <div class="explore-cta__content">
            <h3 class="explore-cta__title">Books A-Z</h3>

            <p class="explore-cta__text">Browse every book in the library alphabetically by title.</p>

            {% comment %} <span class="explore-cta__cta">Browse A-Z -></span> {% endcomment %}
          </div>
        </article>
      </section>
    </div>
{% endblock %}
