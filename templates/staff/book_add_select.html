{% extends 'site_base.html' %}
{% load static %}

{% block title %}
  Select - Add book - Barham Books
{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/pages/add-book-wizard.css' %}" />
{% endblock %}

{% block extra_js %}
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const form = document.getElementById('book-select-form')
      const radios = form.querySelectorAll("input[name='choice']")
    
      radios.forEach((radio) => {
        radio.addEventListener('change', function () {
          form.submit()
        })
      })
    })
  </script>
{% endblock %}

{% block content %}
  <div class="wizard">
    <div class="wrapper">
      {% include 'components/wizard_steps.html' %}

      <section class="wizard__panel full">
        <div class="wizard__header">
          <h1 class="wizard__title">Select a book</h1>
          <p class="wizard__intro">Choose from one of the following books, or proceed manually.</p>
        </div>

        <div class="wizard__body">
          {% if results %}
            <form method="post" class="select-form" id="book-select-form">
              {% csrf_token %}

              <fieldset class="book-results">
                <legend class="visually-hidden">Select a book</legend>

                {% for book in results %}
                  <label class="book-card">
                    <input type="radio" name="choice" value="{{ forloop.counter0 }}" />

                    <div class="book-card__content">
                      {% if forloop.first %}
                        <span class="badge">Most relevant</span>
                      {% endif %}

                      <header class="book-card__header">
                        <h3 class="book-card__title">{{ book.title }}</h3>

                        {% if book.authors %}
                          <p>By {{ book.authors|join:', ' }}</p>
                        {% endif %}

                        <div class="book-card__meta">
                          {% if book.published_year %}
                            <span>Published {{ book.published_year }}</span>
                          {% endif %}
                          {% if book.publisher %}
                            <span>&nbsp;&nbsp;•&nbsp;&nbsp;{{ book.publisher }}</span>
                          {% endif %}
                          {% if book.page_count %}
                            <span>&nbsp;&nbsp;•&nbsp;&nbsp;{{ book.page_count }} pages</span>
                          {% endif %}
                        </div>
                      </header>

                      <div class="book-card__body">
                        {% if book.thumbnail %}
                          <img src="{{ book.thumbnail }}" loading="lazy" alt="" class="book-card__thumb" />
                        {% endif %}

                        {% if book.description %}
                          <p class="book-card__summary">{{ book.description|linebreaksbr }}</p>
                        {% endif %}
                      </div>
                    </div>
                  </label>
                {% endfor %}
              </fieldset>

              <label class="book-card book-card-manual">
                <input type="radio" name="choice" value="manual" />
                <h3 class="book-card__title">Enter details manually</h3>
              </label>

              <div class="select-form__actions">
                <button class="button primary" type="submit">Continue</button>
              </div>
            </form>
          {% endif %}
        </div>
      </section>
    </div>
  </div>
{% endblock %}
